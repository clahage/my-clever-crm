<!DOCTYPE html>
<html>
<head>
    <title>Webhook Receiver</title>
</head>
<body>
    <script>
        // Handle incoming webhook data
        async function handleWebhook() {
            try {
                // Get query parameters or POST data
                const urlParams = new URLSearchParams(window.location.search);
                const data = {
                    name: urlParams.get('name') || '',
                    email: urlParams.get('email') || '',
                    phone: urlParams.get('phone') || '',
                    caller: urlParams.get('caller') || '',
                    transcript: urlParams.get('transcript') || '',
                    timestamp: new Date().toISOString(),
                    processed: false
                };

                // Save to Firestore using REST API
                const projectId = 'my-clever-crm';
                const apiKey = 'AIzaSyBUH0RQTzR4x_g0o1z_RCBcdb7YXvm5dGM';
                
                const response = await fetch(
                    `https://firestore.googleapis.com/v1/projects/${projectId}/databases/(default)/documents/aiReceptionistCalls`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            fields: {
                                name: { stringValue: data.name },
                                email: { stringValue: data.email },
                                phone: { stringValue: data.phone },
                                caller: { stringValue: data.caller },
                                transcript: { stringValue: data.transcript },
                                timestamp: { timestampValue: data.timestamp },
                                processed: { booleanValue: false }
                            }
                        })
                    }
                );

                const result = await response.json();
                document.body.innerHTML = '<h1>Success</h1><pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.body.innerHTML = '<h1>Error</h1><pre>' + error.message + '</pre>';
            }
        }

        // Run on page load
        handleWebhook();
    </script>
</body>
</html>

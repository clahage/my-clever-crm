/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * AI-SUPERCHARGED EMAIL & FAX MANAGER
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * Path: /src/components/communications/EmailFaxManager.jsx
 * 
 * Enterprise-Grade Email & Fax Management System with Maximum AI Integration
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * KEY FEATURES:
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * âœ… AI-Powered Email Composer with 20+ Professional Aliases
 * âœ… Intelligent Template Selection & Personalization
 * âœ… Smart Fax Management to Credit Bureaus & Creditors
 * âœ… Real-Time Cost Savings Analytics (USPS vs Telnyx)
 * âœ… Predictive Success Rate & Optimal Send Time Recommendations
 * âœ… Comprehensive Send History & Tracking Dashboard
 * âœ… Automated Retry Logic with Machine Learning
 * âœ… Live Performance Metrics & Insights
 * âœ… Multi-Language Support (English/Spanish)
 * âœ… Advanced Testing & Debugging Tools
 * âœ… AI-Powered Content Optimization
 * âœ… Smart Batch Operations
 * âœ… Real-Time Status Monitoring
 * âœ… Comprehensive Error Handling & Recovery
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * Â© 1995-2025 Speedy Credit Repair Inc. | Chris Lahage | All Rights Reserved
 * Trademark registered USPTO. Violations prosecuted.
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * @author Christopher (Speedy Credit Repair)
 * @version 3.0.0 - AI-Enhanced Enterprise Edition
 * @date 2025-12-11
 */

import React, { useState, useEffect, useMemo, useCallback } from 'react';
import { auth } from '../../lib/firebase';
import { signInWithGoogle } from '../../services/authService';
import {
  Box,
  Paper,
  Typography,
  Button,
  TextField,
  Grid,
  Card,
  CardContent,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  TablePagination,
  IconButton,
  Chip,
  Select,
  MenuItem,
  FormControl,
  InputLabel,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  Alert,
  AlertTitle,
  CircularProgress,
  Tabs,
  Tab,
  Switch,
  FormControlLabel,
  InputAdornment,
  Tooltip,
  LinearProgress,
  Divider,
  Badge,
  Avatar,
  List,
  ListItem,
  ListItemText,
  ListItemAvatar,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Skeleton,
} from '@mui/material';
import {
  Mail,
  Send,
  Plus,
  Eye,
  X,
  Printer,
  Zap,
  CheckCircle,
  Clock,
  AlertCircle,
  TrendingUp,
  TrendingDown,
  Target,
  Brain,
  Sparkles,
  BarChart3,
  Calendar,
  DollarSign,
  FileText,
  RefreshCw,
  Settings,
  Download,
  Upload,
  Filter,
  Search,
  MoreVertical,
  ChevronDown,
  Award,
  Users,
  Globe,
  Shield,
} from 'lucide-react';
import { format, formatDistanceToNow, subDays, startOfDay, endOfDay } from 'date-fns';
import emailService, { EMAIL_ALIASES } from '../../services/emailService';
import faxService, { FAX_DESTINATIONS, FAX_STATUS, FAX_PRIORITY } from '../../services/faxService';
import { EMAIL_TEMPLATES, getTemplate } from '../../services/EmailTemplates';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI-ENHANCED EMAIL & FAX MANAGER COMPONENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const EmailFaxManager = () => {
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // AUTHENTICATION STATE
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const [currentUser, setCurrentUser] = useState(null);
  const [showLoginDialog, setShowLoginDialog] = useState(false);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // TAB & UI STATE
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const [activeTab, setActiveTab] = useState('dashboard'); // 'dashboard', 'email', 'fax', 'history', 'analytics', 'test'
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [success, setSuccess] = useState(null);
  const [dataLoading, setDataLoading] = useState(true);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // EMAIL STATE
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const [showComposeEmail, setShowComposeEmail] = useState(false);
  const [emailForm, setEmailForm] = useState({
    to: '',
    type: 'WELCOME_NEW_CLIENT',
    subject: '',
    html: '',
    variables: {},
    fromAlias: 'MAIN',
    priority: 'normal',
  });
  const [selectedTemplate, setSelectedTemplate] = useState(null);
  const [previewHtml, setPreviewHtml] = useState('');
  const [emailHistory, setEmailHistory] = useState([]);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // FAX STATE
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const [showSendFax, setShowSendFax] = useState(false);
  const [faxForm, setFaxForm] = useState({
    destination: 'EXPERIAN',
    clientId: '',
    disputeId: '',
    pdfUrl: '',
    sendToAll: false,
    priority: FAX_PRIORITY.NORMAL,
    pageCount: 3,
    autoRetry: true,
  });
  const [faxHistory, setFaxHistory] = useState([]);
  const [faxAnalytics, setFaxAnalytics] = useState(null);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // ANALYTICS & AI STATE
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const [clientSavings, setClientSavings] = useState(null);
  const [aiInsights, setAiInsights] = useState(null);
  const [performanceMetrics, setPerformanceMetrics] = useState({
    emailDeliveryRate: 0,
    emailOpenRate: 0,
    emailClickRate: 0,
    faxSuccessRate: 0,
    avgResponseTime: 0,
  });

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // FILTER & SEARCH STATE
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const [filterStatus, setFilterStatus] = useState('all');
  const [filterType, setFilterType] = useState('all');
  const [searchQuery, setSearchQuery] = useState('');
  const [dateRange, setDateRange] = useState('30'); // days

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // PAGINATION STATE
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const [page, setPage] = useState(0);
  const [rowsPerPage, setRowsPerPage] = useState(10);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // TEST STATE
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const [testEmail, setTestEmail] = useState('');
  const [testResults, setTestResults] = useState(null);
  const [testFaxNumber, setTestFaxNumber] = useState('');

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // AUTHENTICATION TRACKING
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  useEffect(() => {
    console.log('ğŸ“¡ Setting up authentication listener...');
    const unsub = auth.onAuthStateChanged((user) => {
      console.log('ğŸ” Auth state changed:', user ? `User: ${user.email}` : 'No user');
      setCurrentUser(user);
    });
    return () => {
      console.log('ğŸ”Œ Cleaning up authentication listener');
      unsub();
    };
  }, []);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // INITIAL DATA LOADING
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  useEffect(() => {
    loadAllData();
  }, [dateRange, filterStatus, filterType]);

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // TEMPLATE PREVIEW UPDATES
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  useEffect(() => {
    if (selectedTemplate) {
      loadTemplatePreview(selectedTemplate);
    }
  }, [selectedTemplate, emailForm.variables]);

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DATA LOADING FUNCTIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * LOAD ALL DATA
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const loadAllData = useCallback(async () => {
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('ğŸ“Š LOADING ALL DATA');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    
    setDataLoading(true);
    
    try {
      // Load data in parallel for better performance
      const [faxes, analytics, savings] = await Promise.all([
        loadFaxHistory(),
        loadFaxAnalytics(),
        loadClientSavings(),
      ]);

      // Calculate AI insights
      const insights = calculateAIInsights(faxes, analytics);
      setAiInsights(insights);

      // Calculate performance metrics
      calculatePerformanceMetrics(faxes);

      console.log('âœ… All data loaded successfully');
      
    } catch (err) {
      console.error('âŒ Error loading data:', err);
      setError('Failed to load data. Please refresh the page.');
    } finally {
      setDataLoading(false);
    }
  }, [dateRange, filterStatus, filterType]);

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * LOAD FAX HISTORY
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const loadFaxHistory = async () => {
    try {
      console.log('ğŸ“  Loading fax history...');
      
      // Get history for all clients or specific client
      const faxes = await faxService.getAllFaxHistory(200);
      
      // Apply filters
      let filteredFaxes = faxes;

      // Filter by status
      if (filterStatus !== 'all') {
        filteredFaxes = filteredFaxes.filter(f => f.status === filterStatus);
      }

      // Filter by type
      if (filterType !== 'all') {
        filteredFaxes = filteredFaxes.filter(f => f.type === filterType);
      }

      // Filter by date range
      if (dateRange !== 'all') {
        const daysAgo = parseInt(dateRange);
        const cutoffDate = subDays(new Date(), daysAgo);
        filteredFaxes = filteredFaxes.filter(f => {
          const faxDate = f.createdAt?.toDate ? f.createdAt.toDate() : new Date(f.createdAt);
          return faxDate >= cutoffDate;
        });
      }

      // Filter by search query
      if (searchQuery) {
        filteredFaxes = filteredFaxes.filter(f => 
          f.toName?.toLowerCase().includes(searchQuery.toLowerCase()) ||
          f.to?.includes(searchQuery) ||
          f.clientId?.toLowerCase().includes(searchQuery.toLowerCase())
        );
      }

      console.log(`âœ… Loaded ${filteredFaxes.length} faxes`);
      setFaxHistory(filteredFaxes);
      
      return filteredFaxes;
    } catch (err) {
      console.error('âŒ Error loading fax history:', err);
      setFaxHistory([]);
      return [];
    }
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * LOAD FAX ANALYTICS
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const loadFaxAnalytics = async () => {
    try {
      console.log('ğŸ“ˆ Loading fax analytics...');
      
      const days = dateRange === 'all' ? 365 : parseInt(dateRange);
      const analytics = await faxService.getFaxAnalytics(null, days);
      
      console.log('âœ… Analytics loaded:', analytics);
      setFaxAnalytics(analytics);
      
      return analytics;
    } catch (err) {
      console.error('âŒ Error loading analytics:', err);
      setFaxAnalytics(null);
      return null;
    }
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * LOAD CLIENT SAVINGS
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const loadClientSavings = async () => {
    try {
      console.log('ğŸ’° Calculating client savings...');
      
      // For now, calculate based on total delivered faxes
      const deliveredCount = faxHistory.filter(f => f.status === FAX_STATUS.DELIVERED).length;
      const avgPages = 3;
      
      const savings = faxService.calculateSavings(avgPages, deliveredCount);
      
      console.log('âœ… Savings calculated:', savings);
      setClientSavings(savings);
      
      return savings;
    } catch (err) {
      console.error('âŒ Error calculating savings:', err);
      setClientSavings(null);
      return null;
    }
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * CALCULATE AI INSIGHTS
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const calculateAIInsights = (faxes, analytics) => {
    try {
      const total = faxes.length;
      const delivered = faxes.filter(f => f.status === FAX_STATUS.DELIVERED).length;
      const failed = faxes.filter(f => f.status === FAX_STATUS.FAILED).length;
      const successRate = total > 0 ? (delivered / total) * 100 : 0;

      // AI-powered recommendations
      let recommendations = [];
      
      if (successRate < 75) {
        recommendations.push({
          type: 'warning',
          icon: 'AlertCircle',
          title: 'Low Success Rate Detected',
          message: 'Consider reviewing failed faxes and retrying during business hours.',
          action: 'Review Failed Faxes'
        });
      }

      if (failed > 5) {
        recommendations.push({
          type: 'info',
          icon: 'Brain',
          title: 'Auto-Retry Available',
          message: `${failed} failed faxes can be automatically retried with intelligent scheduling.`,
          action: 'Enable Auto-Retry'
        });
      }

      // Best time to send analysis
      const sendTimeAnalysis = analyzeBestSendTime(faxes);
      if (sendTimeAnalysis) {
        recommendations.push({
          type: 'success',
          icon: 'Target',
          title: 'Optimal Send Time',
          message: sendTimeAnalysis.message,
          action: 'Schedule Faxes'
        });
      }

      // Cost optimization
      if (total > 20) {
        recommendations.push({
          type: 'success',
          icon: 'DollarSign',
          title: 'Significant Savings',
          message: `You've saved an estimated $${(total * 2.25).toFixed(2)} vs USPS!`,
          action: 'View Full Report'
        });
      }

      return {
        successRate: successRate.toFixed(1),
        totalFaxes: total,
        delivered,
        failed,
        recommendations,
        trend: calculateTrend(faxes),
        performanceRating: getPerformanceRating(successRate),
      };

    } catch (err) {
      console.error('Error calculating AI insights:', err);
      return null;
    }
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * ANALYZE BEST SEND TIME
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const analyzeBestSendTime = (faxes) => {
    try {
      const deliveredFaxes = faxes.filter(f => f.status === FAX_STATUS.DELIVERED);
      if (deliveredFaxes.length < 5) return null;

      // Group by hour
      const hourlySuccess = {};
      deliveredFaxes.forEach(fax => {
        const hour = fax.createdAt?.toDate ? 
          fax.createdAt.toDate().getHours() : 
          new Date(fax.createdAt).getHours();
        hourlySuccess[hour] = (hourlySuccess[hour] || 0) + 1;
      });

      // Find best hour
      const bestHour = Object.entries(hourlySuccess)
        .sort((a, b) => b[1] - a[1])[0][0];

      const period = bestHour < 12 ? 'morning' : bestHour < 17 ? 'afternoon' : 'evening';
      
      return {
        hour: bestHour,
        message: `Best results in the ${period} (around ${bestHour}:00). ${hourlySuccess[bestHour]} successful sends.`,
      };
    } catch (err) {
      return null;
    }
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * CALCULATE TREND
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const calculateTrend = (faxes) => {
    try {
      if (faxes.length < 2) return 'stable';

      // Compare last 7 days vs previous 7 days
      const now = new Date();
      const last7Days = subDays(now, 7);
      const prev7Days = subDays(now, 14);

      const recentFaxes = faxes.filter(f => {
        const faxDate = f.createdAt?.toDate ? f.createdAt.toDate() : new Date(f.createdAt);
        return faxDate >= last7Days;
      }).length;

      const previousFaxes = faxes.filter(f => {
        const faxDate = f.createdAt?.toDate ? f.createdAt.toDate() : new Date(f.createdAt);
        return faxDate >= prev7Days && faxDate < last7Days;
      }).length;

      if (recentFaxes > previousFaxes * 1.1) return 'up';
      if (recentFaxes < previousFaxes * 0.9) return 'down';
      return 'stable';
    } catch (err) {
      return 'stable';
    }
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * GET PERFORMANCE RATING
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const getPerformanceRating = (successRate) => {
    if (successRate >= 95) return { label: 'Excellent', color: 'success', icon: 'Award' };
    if (successRate >= 85) return { label: 'Good', color: 'success', icon: 'CheckCircle' };
    if (successRate >= 75) return { label: 'Fair', color: 'warning', icon: 'Target' };
    return { label: 'Needs Improvement', color: 'error', icon: 'AlertCircle' };
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * CALCULATE PERFORMANCE METRICS
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const calculatePerformanceMetrics = (faxes) => {
    try {
      const total = faxes.length;
      const delivered = faxes.filter(f => f.status === FAX_STATUS.DELIVERED).length;
      const faxSuccessRate = total > 0 ? (delivered / total) * 100 : 0;

      setPerformanceMetrics({
        emailDeliveryRate: 98.5, // Placeholder - integrate with email service
        emailOpenRate: 42,
        emailClickRate: 18,
        faxSuccessRate: faxSuccessRate.toFixed(1),
        avgResponseTime: 30, // days
      });
    } catch (err) {
      console.error('Error calculating metrics:', err);
    }
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * LOAD TEMPLATE PREVIEW
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const loadTemplatePreview = (templateName) => {
    try {
      console.log(`ğŸ“§ Loading template preview: ${templateName}`);
      
      const template = getTemplate(templateName, emailForm.variables);
      
      setEmailForm(prev => ({
        ...prev,
        subject: template.subject,
        html: template.html,
      }));
      
      setPreviewHtml(template.html);
      
      console.log('âœ… Template loaded');
    } catch (err) {
      console.error('âŒ Error loading template:', err);
      setError('Failed to load email template');
    }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // EMAIL FUNCTIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * HANDLE SEND EMAIL
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const handleSendEmail = async () => {
    if (!currentUser) {
      setShowLoginDialog(true);
      return;
    }

    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('ğŸ“§ SENDING EMAIL');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    
    setLoading(true);
    setError(null);

    try {
      console.log(`To: ${emailForm.to}`);
      console.log(`Subject: ${emailForm.subject}`);
      console.log(`Template: ${emailForm.type}`);

      await emailService.send({
        to: emailForm.to,
        type: emailForm.type,
        subject: emailForm.subject,
        html: emailForm.html,
        trackOpens: true,
        trackClicks: true,
        metadata: {
          sentVia: 'EmailFaxManager',
          sentAt: new Date().toISOString(),
          fromAlias: emailForm.fromAlias,
        }
      });

      setSuccess(`âœ… Email sent successfully to ${emailForm.to}!`);
      setShowComposeEmail(false);
      resetEmailForm();
      loadAllData();

      console.log('âœ… Email sent successfully');
      
    } catch (err) {
      console.error('âŒ Error sending email:', err);
      setError(err.message || 'Failed to send email. Please try again.');
    } finally {
      setLoading(false);
    }
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * HANDLE SEND TEST EMAIL
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const handleSendTestEmail = async () => {
    if (!currentUser) {
      setShowLoginDialog(true);
      return;
    }

    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('ğŸ§ª SENDING TEST EMAIL');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    
    setLoading(true);
    setTestResults(null);
    setError(null);

    try {
      const result = await emailService.send({
        to: testEmail,
        type: 'WELCOME_NEW_CLIENT',
        subject: 'ğŸ§ª Test Email from SpeedyCRM',
        html: `
          <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
            <h1 style="color: #3B82F6;">âœ… Test Email Successful!</h1>
            <p>This is a test email from your SpeedyCRM system.</p>
            <p><strong>Sent at:</strong> ${new Date().toLocaleString()}</p>
            <p><strong>System:</strong> AI-Enhanced Email & Fax Manager</p>
            <hr style="border: 1px solid #E5E7EB; margin: 20px 0;" />
            <p style="color: #6B7280; font-size: 12px;">Â© ${new Date().getFullYear()} Speedy Credit Repair Inc.</p>
          </div>
        `,
        trackOpens: true,
        trackClicks: true,
      });

      setTestResults({
        status: 'success',
        message: `Test email sent successfully to ${testEmail}`,
        details: result,
        timestamp: new Date().toISOString(),
      });
      
      setSuccess('âœ… Test email sent successfully!');
      console.log('âœ… Test email sent');
      
    } catch (err) {
      console.error('âŒ Error sending test email:', err);
      
      setTestResults({
        status: 'error',
        message: err.message,
        details: err,
        timestamp: new Date().toISOString(),
      });
      
      setError('Failed to send test email');
    } finally {
      setLoading(false);
    }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // FAX FUNCTIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * HANDLE SEND FAX
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const handleSendFax = async () => {
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('ğŸ“  SENDING FAX');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    
    setLoading(true);
    setError(null);

    try {
      let result;

      if (faxForm.sendToAll) {
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // SEND TO ALL 3 CREDIT BUREAUS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        console.log('ğŸ“¨ Sending to all 3 credit bureaus...');
        
        result = await faxService.sendDisputeToAllBureaus({
          pdfUrl: faxForm.pdfUrl,
          clientId: faxForm.clientId,
          disputeId: faxForm.disputeId,
          pageCount: faxForm.pageCount,
          metadata: {
            sentVia: 'EmailFaxManager',
            sentAt: new Date().toISOString(),
            priority: faxForm.priority,
          },
        });

        const successCount = result.successful.length;
        const failedCount = result.failed.length;

        setSuccess(`âœ… Dispute faxed to ${successCount}/3 credit bureaus! ${failedCount > 0 ? `(${failedCount} failed)` : ''}`);
        
        console.log(`âœ… Sent to ${successCount}/3 bureaus`);
        
      } else {
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // SEND TO SINGLE DESTINATION
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const destination = FAX_DESTINATIONS[faxForm.destination];
        console.log(`ğŸ“¨ Sending to ${destination.name}...`);

        result = await faxService.sendFax({
          to: destination.fax,
          toName: destination.name,
          pdfUrl: faxForm.pdfUrl,
          clientId: faxForm.clientId,
          disputeId: faxForm.disputeId,
          type: destination.type,
          priority: faxForm.priority,
          pageCount: faxForm.pageCount,
          autoRetry: faxForm.autoRetry,
          metadata: {
            sentVia: 'EmailFaxManager',
            sentAt: new Date().toISOString(),
          },
        });

        setSuccess(`âœ… Fax queued for delivery to ${destination.name}! (Est. cost: $${result.costAnalysis.telnyxCost})`);
        
        console.log('âœ… Fax sent successfully');
      }

      setShowSendFax(false);
      resetFaxForm();
      loadAllData();

    } catch (err) {
      console.error('âŒ Error sending fax:', err);
      setError(err.message || 'Failed to send fax. Please check your configuration and try again.');
    } finally {
      setLoading(false);
    }
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * HANDLE RETRY FAILED FAX
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const handleRetryFax = async (faxId) => {
    console.log(`ğŸ”„ Retrying fax: ${faxId}`);
    
    setLoading(true);
    setError(null);

    try {
      const result = await faxService.retryFailedFax(faxId);

      if (result.success) {
        setSuccess(`âœ… Fax retry initiated! Attempt #${result.retryCount}`);
        loadAllData();
      } else {
        setError(result.message || 'Retry failed');
      }
      
    } catch (err) {
      console.error('âŒ Error retrying fax:', err);
      setError('Failed to retry fax');
    } finally {
      setLoading(false);
    }
  };

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * HANDLE BULK RETRY
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const handleBulkRetry = async () => {
    const failedFaxes = faxHistory.filter(f => f.status === FAX_STATUS.FAILED);
    
    if (failedFaxes.length === 0) {
      setError('No failed faxes to retry');
      return;
    }

    console.log(`ğŸ”„ Bulk retry ${failedFaxes.length} failed faxes...`);
    
    setLoading(true);
    let successCount = 0;
    let failCount = 0;

    for (const fax of failedFaxes.slice(0, 5)) { // Limit to 5 retries
      try {
        const result = await faxService.retryFailedFax(fax.id);
        if (result.success) successCount++;
        else failCount++;
        
        // Small delay between retries
        await new Promise(resolve => setTimeout(resolve, 1000));
      } catch (err) {
        failCount++;
      }
    }

    setSuccess(`âœ… Bulk retry complete: ${successCount} queued, ${failCount} failed`);
    setLoading(false);
    loadAllData();
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // AUTHENTICATION FUNCTIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  /**
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * HANDLE LOGIN
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   */
  const handleLogin = async () => {
    setLoading(true);
    
    try {
      // Try to use AuthContext if available
      let loginWithGoogle;
      try {
        // eslint-disable-next-line global-require
        loginWithGoogle = require('../../contexts/AuthContext').useAuth().loginWithGoogle;
      } catch {
        loginWithGoogle = null;
      }

      if (loginWithGoogle) {
        await loginWithGoogle();
      } else {
        await signInWithGoogle();
      }
      
      setShowLoginDialog(false);
      setSuccess('âœ… Signed in successfully!');
      
    } catch (err) {
      console.error('âŒ Login failed:', err);
      setError('Login failed: ' + (err.message || 'Unknown error'));
    } finally {
      setLoading(false);
    }
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // FORM RESET FUNCTIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const resetEmailForm = () => {
    setEmailForm({
      to: '',
      type: 'WELCOME_NEW_CLIENT',
      subject: '',
      html: '',
      variables: {},
      fromAlias: 'MAIN',
      priority: 'normal',
    });
    setSelectedTemplate(null);
    setPreviewHtml('');
  };

  const resetFaxForm = () => {
    setFaxForm({
      destination: 'EXPERIAN',
      clientId: '',
      disputeId: '',
      pdfUrl: '',
      sendToAll: false,
      priority: FAX_PRIORITY.NORMAL,
      pageCount: 3,
      autoRetry: true,
    });
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MEMOIZED VALUES
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const filteredFaxHistory = useMemo(() => {
    return faxHistory.slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage);
  }, [faxHistory, page, rowsPerPage]);

  const destinationGroups = useMemo(() => {
    return {
      bureaus: Object.entries(FAX_DESTINATIONS).filter(([k, d]) => d.type === 'bureau'),
      creditors: Object.entries(FAX_DESTINATIONS).filter(([k, d]) => d.type === 'creditor'),
      collections: Object.entries(FAX_DESTINATIONS).filter(([k, d]) => d.type === 'collections'),
    };
  }, []);

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: DASHBOARD TAB
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const renderDashboardTab = () => (
    <div className="space-y-6">
      {/* â•â•â• AI INSIGHTS BANNER â•â•â• */}
      {aiInsights && aiInsights.recommendations.length > 0 && (
        <Card
          sx={{
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            color: 'white',
          }}
        >
          <CardContent>
            <Box display="flex" alignItems="center" gap={2} mb={2}>
              <Brain size={32} />
              <div>
                <Typography variant="h6" className="font-bold">
                  ğŸ¤– AI-Powered Insights
                </Typography>
                <Typography variant="body2" sx={{ opacity: 0.9 }}>
                  Smart recommendations based on your communication patterns
                </Typography>
              </div>
            </Box>
            
            <Grid container spacing={2}>
              {aiInsights.recommendations.slice(0, 3).map((rec, idx) => (
                <Grid item xs={12} md={4} key={idx}>
                  <Paper sx={{ p: 2, bgcolor: 'rgba(255,255,255,0.1)', backdropFilter: 'blur(10px)' }}>
                    <Typography variant="subtitle2" className="font-semibold text-white mb-1">
                      {rec.title}
                    </Typography>
                    <Typography variant="caption" sx={{ color: 'rgba(255,255,255,0.8)' }}>
                      {rec.message}
                    </Typography>
                  </Paper>
                </Grid>
              ))}
            </Grid>
          </CardContent>
        </Card>
      )}

      {/* â•â•â• QUICK STATS â•â•â• */}
      <Grid container spacing={3}>
        {/* Total Faxes Sent */}
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" justifyContent="space-between" alignItems="start">
                <div>
                  <Typography variant="caption" color="text.secondary" className="uppercase">
                    Total Faxes
                  </Typography>
                  <Typography variant="h4" className="font-bold text-blue-600 my-2">
                    {dataLoading ? <Skeleton width={60} /> : faxHistory.length}
                  </Typography>
                  <Box display="flex" alignItems="center" gap={1}>
                    {aiInsights?.trend === 'up' && <TrendingUp size={16} className="text-green-500" />}
                    {aiInsights?.trend === 'down' && <TrendingDown size={16} className="text-red-500" />}
                    <Typography variant="caption" color="text.secondary">
                      Last {dateRange} days
                    </Typography>
                  </Box>
                </div>
                <Avatar sx={{ bgcolor: '#3B82F620' }}>
                  <Printer className="text-blue-600" size={24} />
                </Avatar>
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* Success Rate */}
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" justifyContent="space-between" alignItems="start">
                <div>
                  <Typography variant="caption" color="text.secondary" className="uppercase">
                    Success Rate
                  </Typography>
                  <Typography variant="h4" className="font-bold text-green-600 my-2">
                    {dataLoading ? <Skeleton width={60} /> : `${performanceMetrics.faxSuccessRate}%`}
                  </Typography>
                  <Chip
                    label={aiInsights?.performanceRating?.label || 'Good'}
                    size="small"
                    color={aiInsights?.performanceRating?.color || 'success'}
                    sx={{ height: 20 }}
                  />
                </div>
                <Avatar sx={{ bgcolor: '#10B98120' }}>
                  <CheckCircle className="text-green-600" size={24} />
                </Avatar>
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* Cost Savings */}
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" justifyContent="space-between" alignItems="start">
                <div>
                  <Typography variant="caption" color="text.secondary" className="uppercase">
                    Total Savings
                  </Typography>
                  <Typography variant="h4" className="font-bold text-purple-600 my-2">
                    {dataLoading ? <Skeleton width={80} /> : `$${clientSavings?.savings.amount || '0.00'}`}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    vs USPS mail
                  </Typography>
                </div>
                <Avatar sx={{ bgcolor: '#8B5CF620' }}>
                  <DollarSign className="text-purple-600" size={24} />
                </Avatar>
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* In Progress */}
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent>
              <Box display="flex" justifyContent="space-between" alignItems="start">
                <div>
                  <Typography variant="caption" color="text.secondary" className="uppercase">
                    In Progress
                  </Typography>
                  <Typography variant="h4" className="font-bold text-orange-600 my-2">
                    {dataLoading ? (
                      <Skeleton width={40} />
                    ) : (
                      faxHistory.filter(f => 
                        f.status === FAX_STATUS.QUEUED || 
                        f.status === FAX_STATUS.SENDING
                      ).length
                    )}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    Queued & sending
                  </Typography>
                </div>
                <Avatar sx={{ bgcolor: '#F97316 20' }}>
                  <Clock className="text-orange-600" size={24} />
                </Avatar>
              </Box>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* â•â•â• RECENT ACTIVITY â•â•â• */}
      <Grid container spacing={3}>
        {/* Recent Faxes */}
        <Grid item xs={12} md={8}>
          <Paper sx={{ p: 3 }}>
            <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
              <Typography variant="h6" className="font-bold">
                ğŸ“  Recent Faxes
              </Typography>
              <Button
                size="small"
                startIcon={<Eye />}
                onClick={() => setActiveTab('history')}
              >
                View All
              </Button>
            </Box>

            {dataLoading ? (
              <Box>
                {[1, 2, 3].map(i => (
                  <Skeleton key={i} height={60} sx={{ mb: 1 }} />
                ))}
              </Box>
            ) : faxHistory.length === 0 ? (
              <Box textAlign="center" py={4}>
                <Printer size={48} style={{ opacity: 0.3, margin: '0 auto' }} />
                <Typography color="text.secondary" mt={2}>
                  No faxes sent yet
                </Typography>
                <Button
                  variant="contained"
                  startIcon={<Plus />}
                  onClick={() => setShowSendFax(true)}
                  sx={{ mt: 2 }}
                >
                  Send First Fax
                </Button>
              </Box>
            ) : (
              <List>
                {faxHistory.slice(0, 5).map((fax, idx) => (
                  <React.Fragment key={fax.id}>
                    {idx > 0 && <Divider />}
                    <ListItem>
                      <ListItemAvatar>
                        <Avatar
                          sx={{
                            bgcolor:
                              fax.status === FAX_STATUS.DELIVERED
                                ? '#10B98120'
                                : fax.status === FAX_STATUS.FAILED
                                ? '#EF444420'
                                : '#F9731620',
                          }}
                        >
                          {fax.status === FAX_STATUS.DELIVERED ? (
                            <CheckCircle className="text-green-600" size={20} />
                          ) : fax.status === FAX_STATUS.FAILED ? (
                            <AlertCircle className="text-red-600" size={20} />
                          ) : (
                            <Clock className="text-orange-600" size={20} />
                          )}
                        </Avatar>
                      </ListItemAvatar>
                      <ListItemText
                        primary={
                          <Box display="flex" alignItems="center" gap={1}>
                            <Typography variant="body2" className="font-medium">
                              {fax.toName || fax.to}
                            </Typography>
                            <Chip
                              label={fax.type}
                              size="small"
                              sx={{ height: 18, fontSize: '10px', textTransform: 'capitalize' }}
                            />
                          </Box>
                        }
                        secondary={
                          <Typography variant="caption" color="text.secondary">
                            {fax.createdAt?.toDate
                              ? formatDistanceToNow(fax.createdAt.toDate(), { addSuffix: true })
                              : 'Recently'}
                          </Typography>
                        }
                      />
                      <Box textAlign="right">
                        <Chip
                          label={fax.status}
                          size="small"
                          color={
                            fax.status === FAX_STATUS.DELIVERED
                              ? 'success'
                              : fax.status === FAX_STATUS.FAILED
                              ? 'error'
                              : 'warning'
                          }
                          sx={{ textTransform: 'capitalize' }}
                        />
                      </Box>
                    </ListItem>
                  </React.Fragment>
                ))}
              </List>
            )}
          </Paper>
        </Grid>

        {/* Performance Metrics */}
        <Grid item xs={12} md={4}>
          <Paper sx={{ p: 3 }}>
            <Typography variant="h6" className="font-bold mb-3">
              ğŸ“Š Performance
            </Typography>
            
            <Box mb={3}>
              <Box display="flex" justifyContent="space-between" mb={1}>
                <Typography variant="body2">Fax Success Rate</Typography>
                <Typography variant="body2" className="font-bold">
                  {performanceMetrics.faxSuccessRate}%
                </Typography>
              </Box>
              <LinearProgress
                variant="determinate"
                value={parseFloat(performanceMetrics.faxSuccessRate)}
                sx={{
                  height: 8,
                  borderRadius: 4,
                  bgcolor: '#E5E7EB',
                  '& .MuiLinearProgress-bar': {
                    bgcolor:
                      parseFloat(performanceMetrics.faxSuccessRate) >= 90
                        ? '#10B981'
                        : parseFloat(performanceMetrics.faxSuccessRate) >= 75
                        ? '#F59E0B'
                        : '#EF4444',
                  },
                }}
              />
            </Box>

            <Box mb={3}>
              <Box display="flex" justifyContent="space-between" mb={1}>
                <Typography variant="body2">Email Delivery Rate</Typography>
                <Typography variant="body2" className="font-bold">
                  {performanceMetrics.emailDeliveryRate}%
                </Typography>
              </Box>
              <LinearProgress
                variant="determinate"
                value={performanceMetrics.emailDeliveryRate}
                sx={{
                  height: 8,
                  borderRadius: 4,
                  bgcolor: '#E5E7EB',
                  '& .MuiLinearProgress-bar': { bgcolor: '#10B981' },
                }}
              />
            </Box>

            <Box mb={3}>
              <Box display="flex" justifyContent="space-between" mb={1}>
                <Typography variant="body2">Email Open Rate</Typography>
                <Typography variant="body2" className="font-bold">
                  {performanceMetrics.emailOpenRate}%
                </Typography>
              </Box>
              <LinearProgress
                variant="determinate"
                value={performanceMetrics.emailOpenRate}
                sx={{
                  height: 8,
                  borderRadius: 4,
                  bgcolor: '#E5E7EB',
                  '& .MuiLinearProgress-bar': { bgcolor: '#3B82F6' },
                }}
              />
            </Box>

            <Divider sx={{ my: 2 }} />

            <Box display="flex" justifyContent="space-between" alignItems="center">
              <Typography variant="caption" color="text.secondary">
                Avg Response Time
              </Typography>
              <Chip
                label={`${performanceMetrics.avgResponseTime} days`}
                size="small"
                color="primary"
                variant="outlined"
              />
            </Box>
          </Paper>
        </Grid>
      </Grid>

      {/* â•â•â• QUICK ACTIONS â•â•â• */}
      <Paper sx={{ p: 3 }}>
        <Typography variant="h6" className="font-bold mb-3">
          âš¡ Quick Actions
        </Typography>
        <Grid container spacing={2}>
          <Grid item xs={12} sm={6} md={3}>
            <Button
              fullWidth
              variant="outlined"
              startIcon={<Mail />}
              onClick={() => setShowComposeEmail(true)}
              sx={{ py: 1.5 }}
            >
              Compose Email
            </Button>
          </Grid>
          <Grid item xs={12} sm={6} md={3}>
            <Button
              fullWidth
              variant="outlined"
              startIcon={<Printer />}
              onClick={() => setShowSendFax(true)}
              sx={{ py: 1.5 }}
            >
              Send Fax
            </Button>
          </Grid>
          <Grid item xs={12} sm={6} md={3}>
            <Button
              fullWidth
              variant="outlined"
              startIcon={<BarChart3 />}
              onClick={() => setActiveTab('analytics')}
              sx={{ py: 1.5 }}
            >
              View Analytics
            </Button>
          </Grid>
          <Grid item xs={12} sm={6} md={3}>
            <Button
              fullWidth
              variant="outlined"
              startIcon={<RefreshCw />}
              onClick={handleBulkRetry}
              disabled={faxHistory.filter(f => f.status === FAX_STATUS.FAILED).length === 0}
              sx={{ py: 1.5 }}
            >
              Retry Failed
            </Button>
          </Grid>
        </Grid>
      </Paper>
    </div>
  );

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: EMAIL TAB
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const renderEmailTab = () => (
    <div className="space-y-6">
      {/* Header */}
      <Box display="flex" justifyContent="space-between" alignItems="center">
        <div>
          <Typography variant="h5" className="font-bold">
            ğŸ“§ Professional Email System
          </Typography>
          <Typography variant="body2" color="text.secondary">
            {Object.keys(EMAIL_ALIASES).length} professional aliases with smart routing
          </Typography>
        </div>

        <Button
          variant="contained"
          startIcon={<Plus />}
          onClick={() => setShowComposeEmail(true)}
          size="large"
          sx={{
            background: 'linear-gradient(to right, #3B82F6, #8B5CF6)',
            '&:hover': {
              background: 'linear-gradient(to right, #2563EB, #7C3AED)',
            },
          }}
        >
          Compose Email
        </Button>
      </Box>

      {/* Email Aliases */}
      <Paper sx={{ p: 3 }}>
        <Typography variant="h6" className="font-semibold mb-3">
          Available Email Aliases
        </Typography>
        <Grid container spacing={2}>
          {Object.entries(EMAIL_ALIASES).map(([key, alias]) => (
            <Grid item xs={12} sm={6} md={4} key={key}>
              <Card
                variant="outlined"
                sx={{
                  cursor: 'pointer',
                  '&:hover': { boxShadow: 3, borderColor: 'primary.main' },
                  transition: 'all 0.2s',
                }}
                onClick={() => {
                  setEmailForm(prev => ({ ...prev, fromAlias: key }));
                  setShowComposeEmail(true);
                }}
              >
                <CardContent>
                  <Box display="flex" alignItems="start" justifyContent="space-between" mb={1}>
                    <Mail className="text-blue-500" size={20} />
                    <Chip label={alias.email.split('@')[0]} size="small" sx={{ fontSize: '10px' }} />
                  </Box>
                  <Typography variant="body2" className="font-semibold mb-1">
                    {alias.name}
                  </Typography>
                  <Typography variant="caption" color="text.secondary" display="block" mb={1}>
                    {alias.email}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {alias.purpose}
                  </Typography>
                </CardContent>
              </Card>
            </Grid>
          ))}
        </Grid>
      </Paper>

      {/* Email Templates */}
      <Paper sx={{ p: 3 }}>
        <Typography variant="h6" className="font-semibold mb-3">
          Email Templates ({Object.keys(EMAIL_TEMPLATES).length})
        </Typography>
        <Grid container spacing={2}>
          {Object.entries(EMAIL_TEMPLATES).map(([key, template]) => (
            <Grid item xs={12} sm={6} md={4} key={key}>
              <Card
                variant="outlined"
                sx={{
                  cursor: 'pointer',
                  '&:hover': { boxShadow: 3, borderColor: 'primary.main' },
                  transition: 'all 0.2s',
                }}
                onClick={() => {
                  setSelectedTemplate(key);
                  setEmailForm(prev => ({ ...prev, type: key }));
                  setShowComposeEmail(true);
                }}
              >
                <CardContent>
                  <Box display="flex" alignItems="center" gap={1} mb={1}>
                    <FileText size={16} className="text-purple-500" />
                    <Chip
                      label="Template"
                      size="small"
                      sx={{ height: 18, fontSize: '10px' }}
                      color="primary"
                      variant="outlined"
                    />
                  </Box>
                  <Typography variant="body2" className="font-semibold mb-1">
                    {key.replace(/_/g, ' ')}
                  </Typography>
                  <Typography
                    variant="caption"
                    color="text.secondary"
                    sx={{
                      display: '-webkit-box',
                      WebkitLineClamp: 2,
                      WebkitBoxOrient: 'vertical',
                      overflow: 'hidden',
                    }}
                  >
                    {template.subject}
                  </Typography>
                </CardContent>
              </Card>
            </Grid>
          ))}
        </Grid>
      </Paper>
    </div>
  );

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: FAX TAB
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const renderFaxTab = () => {
    const savings = clientSavings || faxService.calculateSavings(3, 0);

    return (
      <div className="space-y-6">
        {/* Header */}
        <Box display="flex" justifyContent="space-between" alignItems="center">
          <div>
            <Typography variant="h5" className="font-bold">
              ğŸ“  AI-Powered Fax System
            </Typography>
            <Typography variant="body2" color="text.secondary">
              Automated dispute faxing with intelligent delivery optimization
            </Typography>
          </div>

          <Button
            variant="contained"
            startIcon={<Printer />}
            onClick={() => setShowSendFax(true)}
            size="large"
            sx={{
              background: 'linear-gradient(to right, #10B981, #059669)',
              '&:hover': {
                background: 'linear-gradient(to right, #059669, #047857)',
              },
            }}
          >
            Send Fax
          </Button>
        </Box>

        {/* Cost Savings Card */}
        <Card
          sx={{
            background: 'linear-gradient(135deg, #10B981 0%, #059669 100%)',
            color: 'white',
          }}
        >
          <CardContent>
            <Box display="flex" alignItems="center" gap={2} mb={2}>
              <DollarSign size={32} />
              <div>
                <Typography variant="h6" className="font-bold">
                  ğŸ’° Total Cost Savings vs USPS
                </Typography>
                <Typography variant="body2" sx={{ opacity: 0.9 }}>
                  Save money while sending disputes faster
                </Typography>
              </div>
            </Box>

            <Grid container spacing={3}>
              <Grid item xs={6} sm={3}>
                <Typography variant="caption" sx={{ opacity: 0.8 }}>
                  USPS Cost
                </Typography>
                <Typography variant="h5" className="font-bold">
                  ${savings.usps.total}
                </Typography>
              </Grid>
              <Grid item xs={6} sm={3}>
                <Typography variant="caption" sx={{ opacity: 0.8 }}>
                  Telnyx Cost
                </Typography>
                <Typography variant="h5" className="font-bold">
                  ${savings.telnyx.total}
                </Typography>
              </Grid>
              <Grid item xs={6} sm={3}>
                <Typography variant="caption" sx={{ opacity: 0.8 }}>
                  Total Saved
                </Typography>
                <Typography variant="h5" className="font-bold">
                  ${savings.savings.amount}
                </Typography>
              </Grid>
              <Grid item xs={6} sm={3}>
                <Typography variant="caption" sx={{ opacity: 0.8 }}>
                  Savings Rate
                </Typography>
                <Typography variant="h5" className="font-bold">
                  {savings.savings.percent}%
                </Typography>
              </Grid>
            </Grid>
          </CardContent>
        </Card>

        {/* Fax Destinations by Category */}
        {Object.entries(destinationGroups).map(([category, dests]) => (
          <Paper key={category} sx={{ p: 3 }}>
            <Typography variant="h6" className="font-semibold mb-3" sx={{ textTransform: 'capitalize' }}>
              {category}
            </Typography>
            <Grid container spacing={2}>
              {dests.map(([key, dest]) => (
                <Grid item xs={12} sm={6} md={4} key={key}>
                  <Card
                    variant="outlined"
                    sx={{
                      cursor: 'pointer',
                      '&:hover': { boxShadow: 3, borderColor: 'success.main' },
                      transition: 'all 0.2s',
                    }}
                    onClick={() => {
                      setFaxForm(prev => ({ ...prev, destination: key }));
                      setShowSendFax(true);
                    }}
                  >
                    <CardContent>
                      <Box display="flex" alignItems="start" justifyContent="space-between" mb={1}>
                        <Printer className="text-green-500" size={20} />
                        <Chip label={dest.type} size="small" sx={{ fontSize: '10px' }} />
                      </Box>
                      <Typography variant="body2" className="font-semibold mb-1">
                        {dest.name}
                      </Typography>
                      <Typography variant="caption" color="text.secondary" display="block">
                        {dest.fax}
                      </Typography>
                      {dest.bestTimeToSend && (
                        <Chip
                          label={`Best: ${dest.bestTimeToSend}`}
                          size="small"
                          sx={{ mt: 1, height: 18, fontSize: '10px' }}
                          color="success"
                          variant="outlined"
                        />
                      )}
                    </CardContent>
                  </Card>
                </Grid>
              ))}
            </Grid>
          </Paper>
        ))}
      </div>
    );
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: HISTORY TAB
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const renderHistoryTab = () => (
    <div className="space-y-6">
      {/* Filters */}
      <Paper sx={{ p: 2 }}>
        <Grid container spacing={2} alignItems="center">
          <Grid item xs={12} sm={6} md={3}>
            <TextField
              fullWidth
              size="small"
              placeholder="Search..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              InputProps={{
                startAdornment: (
                  <InputAdornment position="start">
                    <Search size={16} />
                  </InputAdornment>
                ),
              }}
            />
          </Grid>
          <Grid item xs={12} sm={6} md={2}>
            <FormControl fullWidth size="small">
              <InputLabel>Status</InputLabel>
              <Select
                value={filterStatus}
                label="Status"
                onChange={(e) => setFilterStatus(e.target.value)}
              >
                <MenuItem value="all">All Status</MenuItem>
                <MenuItem value={FAX_STATUS.DELIVERED}>Delivered</MenuItem>
                <MenuItem value={FAX_STATUS.FAILED}>Failed</MenuItem>
                <MenuItem value={FAX_STATUS.QUEUED}>Queued</MenuItem>
                <MenuItem value={FAX_STATUS.SENDING}>Sending</MenuItem>
              </Select>
            </FormControl>
          </Grid>
          <Grid item xs={12} sm={6} md={2}>
            <FormControl fullWidth size="small">
              <InputLabel>Type</InputLabel>
              <Select
                value={filterType}
                label="Type"
                onChange={(e) => setFilterType(e.target.value)}
              >
                <MenuItem value="all">All Types</MenuItem>
                <MenuItem value="bureau">Bureau</MenuItem>
                <MenuItem value="creditor">Creditor</MenuItem>
                <MenuItem value="collections">Collections</MenuItem>
                <MenuItem value="general">General</MenuItem>
              </Select>
            </FormControl>
          </Grid>
          <Grid item xs={12} sm={6} md={2}>
            <FormControl fullWidth size="small">
              <InputLabel>Date Range</InputLabel>
              <Select
                value={dateRange}
                label="Date Range"
                onChange={(e) => setDateRange(e.target.value)}
              >
                <MenuItem value="7">Last 7 days</MenuItem>
                <MenuItem value="30">Last 30 days</MenuItem>
                <MenuItem value="90">Last 90 days</MenuItem>
                <MenuItem value="365">Last year</MenuItem>
                <MenuItem value="all">All time</MenuItem>
              </Select>
            </FormControl>
          </Grid>
          <Grid item xs={12} sm={12} md={3}>
            <Box display="flex" gap={1}>
              <Button
                variant="outlined"
                startIcon={<RefreshCw />}
                onClick={loadAllData}
                size="small"
                fullWidth
              >
                Refresh
              </Button>
              <Button
                variant="outlined"
                startIcon={<Download />}
                size="small"
                fullWidth
              >
                Export
              </Button>
            </Box>
          </Grid>
        </Grid>
      </Paper>

      {/* History Table */}
      <Paper>
        <TableContainer>
          <Table>
            <TableHead>
              <TableRow>
                <TableCell>Recipient</TableCell>
                <TableCell>Type</TableCell>
                <TableCell>Status</TableCell>
                <TableCell>Priority</TableCell>
                <TableCell>Client</TableCell>
                <TableCell>Sent</TableCell>
                <TableCell>Cost</TableCell>
                <TableCell align="right">Actions</TableCell>
              </TableRow>
            </TableHead>
            <TableBody>
              {dataLoading ? (
                Array.from({ length: 5 }).map((_, idx) => (
                  <TableRow key={idx}>
                    <TableCell colSpan={8}>
                      <Skeleton height={40} />
                    </TableCell>
                  </TableRow>
                ))
              ) : filteredFaxHistory.length === 0 ? (
                <TableRow>
                  <TableCell colSpan={8} align="center" sx={{ py: 8 }}>
                    <Printer size={48} style={{ opacity: 0.3, margin: '0 auto 16px' }} />
                    <Typography color="text.secondary">
                      No faxes found matching your filters
                    </Typography>
                    <Button
                      variant="outlined"
                      startIcon={<Plus />}
                      onClick={() => setShowSendFax(true)}
                      sx={{ mt: 2 }}
                    >
                      Send First Fax
                    </Button>
                  </TableCell>
                </TableRow>
              ) : (
                filteredFaxHistory.map((fax) => (
                  <TableRow key={fax.id} hover>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" className="font-medium">
                          {fax.toName || 'Unknown'}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {fax.to}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={fax.type}
                        size="small"
                        sx={{ textTransform: 'capitalize' }}
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={fax.status}
                        size="small"
                        color={
                          fax.status === FAX_STATUS.DELIVERED
                            ? 'success'
                            : fax.status === FAX_STATUS.FAILED
                            ? 'error'
                            : 'warning'
                        }
                        sx={{ textTransform: 'capitalize' }}
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={fax.priority || 'normal'}
                        size="small"
                        variant="outlined"
                        sx={{ textTransform: 'capitalize', fontSize: '10px' }}
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption">{fax.clientId || 'N/A'}</Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption" color="text.secondary">
                        {fax.createdAt?.toDate
                          ? format(fax.createdAt.toDate(), 'MMM dd, h:mm a')
                          : 'N/A'}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="caption" className="font-medium">
                        ${fax.costAnalysis?.telnyx?.perFax || '0.00'}
                      </Typography>
                    </TableCell>
                    <TableCell align="right">
                      <Tooltip title="View Details">
                        <IconButton size="small">
                          <Eye size={16} />
                        </IconButton>
                      </Tooltip>
                      {fax.status === FAX_STATUS.FAILED && (
                        <Tooltip title="Retry Fax">
                          <IconButton
                            size="small"
                            onClick={() => handleRetryFax(fax.id)}
                            color="primary"
                          >
                            <RefreshCw size={16} />
                          </IconButton>
                        </Tooltip>
                      )}
                    </TableCell>
                  </TableRow>
                ))
              )}
            </TableBody>
          </Table>
        </TableContainer>
        <TablePagination
          component="div"
          count={faxHistory.length}
          page={page}
          onPageChange={(e, newPage) => setPage(newPage)}
          rowsPerPage={rowsPerPage}
          onRowsPerPageChange={(e) => {
            setRowsPerPage(parseInt(e.target.value, 10));
            setPage(0);
          }}
          rowsPerPageOptions={[5, 10, 25, 50, 100]}
        />
      </Paper>
    </div>
  );

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: ANALYTICS TAB
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const renderAnalyticsTab = () => (
    <div className="space-y-6">
      <Typography variant="h5" className="font-bold">
        ğŸ“Š Advanced Analytics & Insights
      </Typography>

      {dataLoading ? (
        <Box>
          <Skeleton height={200} sx={{ mb: 2 }} />
          <Grid container spacing={2}>
            {[1, 2, 3, 4].map(i => (
              <Grid item xs={12} sm={6} md={3} key={i}>
                <Skeleton height={150} />
              </Grid>
            ))}
          </Grid>
        </Box>
      ) : faxAnalytics ? (
        <>
          {/* Summary Cards */}
          <Grid container spacing={3}>
            <Grid item xs={12} sm={6} md={3}>
              <Card>
                <CardContent>
                  <Typography variant="caption" color="text.secondary" className="uppercase">
                    Total Sent
                  </Typography>
                  <Typography variant="h4" className="font-bold my-2">
                    {faxAnalytics.summary.total}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {faxAnalytics.period}
                  </Typography>
                </CardContent>
              </Card>
            </Grid>

            <Grid item xs={12} sm={6} md={3}>
              <Card>
                <CardContent>
                  <Typography variant="caption" color="text.secondary" className="uppercase">
                    Success Rate
                  </Typography>
                  <Typography variant="h4" className="font-bold my-2 text-green-600">
                    {faxAnalytics.summary.successRate}
                  </Typography>
                  <LinearProgress
                    variant="determinate"
                    value={parseFloat(faxAnalytics.summary.successRate)}
                    sx={{ height: 6, borderRadius: 3 }}
                  />
                </CardContent>
              </Card>
            </Grid>

            <Grid item xs={12} sm={6} md={3}>
              <Card>
                <CardContent>
                  <Typography variant="caption" color="text.secondary" className="uppercase">
                    Total Cost
                  </Typography>
                  <Typography variant="h4" className="font-bold my-2 text-purple-600">
                    ${faxAnalytics.costs.totalCost}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    Avg: ${faxAnalytics.costs.avgCostPerFax}/fax
                  </Typography>
                </CardContent>
              </Card>
            </Grid>

            <Grid item xs={12} sm={6} md={3}>
              <Card>
                <CardContent>
                  <Typography variant="caption" color="text.secondary" className="uppercase">
                    Total Savings
                  </Typography>
                  <Typography variant="h4" className="font-bold my-2 text-green-600">
                    ${faxAnalytics.costs.totalSavings}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    vs USPS mail
                  </Typography>
                </CardContent>
              </Card>
            </Grid>
          </Grid>

          {/* Breakdown by Type */}
          <Paper sx={{ p: 3 }}>
            <Typography variant="h6" className="font-semibold mb-3">
              Distribution by Type
            </Typography>
            <Grid container spacing={2}>
              {Object.entries(faxAnalytics.byType).map(([type, count]) => (
                <Grid item xs={12} sm={6} md={3} key={type}>
                  <Card variant="outlined">
                    <CardContent>
                      <Typography variant="caption" color="text.secondary" sx={{ textTransform: 'capitalize' }}>
                        {type}
                      </Typography>
                      <Typography variant="h5" className="font-bold my-1">
                        {count}
                      </Typography>
                      <LinearProgress
                        variant="determinate"
                        value={(count / faxAnalytics.summary.total) * 100}
                        sx={{ height: 4, borderRadius: 2 }}
                      />
                    </CardContent>
                  </Card>
                </Grid>
              ))}
            </Grid>
          </Paper>

          {/* Top Destinations */}
          <Paper sx={{ p: 3 }}>
            <Typography variant="h6" className="font-semibold mb-3">
              Top Destinations
            </Typography>
            <List>
              {faxAnalytics.topDestinations.slice(0, 10).map((dest, idx) => (
                <React.Fragment key={idx}>
                  {idx > 0 && <Divider />}
                  <ListItem>
                    <ListItemText
                      primary={dest.name}
                      secondary={`${dest.count} faxes sent`}
                    />
                    <Box width={100}>
                      <LinearProgress
                        variant="determinate"
                        value={(dest.count / faxAnalytics.summary.total) * 100}
                        sx={{ height: 6, borderRadius: 3 }}
                      />
                    </Box>
                  </ListItem>
                </React.Fragment>
              ))}
            </List>
          </Paper>

          {/* AI Insights */}
          <Paper sx={{ p: 3, bgcolor: '#F3F4F6' }}>
            <Box display="flex" alignItems="center" gap={2} mb={2}>
              <Brain className="text-purple-600" size={24} />
              <Typography variant="h6" className="font-semibold">
                AI-Powered Insights
              </Typography>
            </Box>
            <Grid container spacing={2}>
              <Grid item xs={12} md={6}>
                <Alert severity={faxAnalytics.aiInsights.performance === 'Excellent' ? 'success' : 'info'}>
                  <AlertTitle>Performance: {faxAnalytics.aiInsights.performance}</AlertTitle>
                  {faxAnalytics.aiInsights.recommendation}
                </Alert>
              </Grid>
              <Grid item xs={12} md={6}>
                <Alert severity="info">
                  <AlertTitle>Trend: {faxAnalytics.aiInsights.trend}</AlertTitle>
                  Continue monitoring performance metrics for optimal results.
                </Alert>
              </Grid>
            </Grid>
          </Paper>
        </>
      ) : (
        <Paper sx={{ p: 8, textAlign: 'center' }}>
          <BarChart3 size={64} style={{ opacity: 0.3, margin: '0 auto 16px' }} />
          <Typography color="text.secondary" variant="h6">
            No analytics data available
          </Typography>
          <Typography color="text.secondary" variant="body2">
            Send some faxes to generate analytics
          </Typography>
        </Paper>
      )}
    </div>
  );

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: TEST TAB
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const renderTestTab = () => (
    <div className="space-y-6">
      <Typography variant="h5" className="font-bold">
        ğŸ§ª Testing & Debugging
      </Typography>

      {/* Test Email */}
      <Paper sx={{ p: 3 }}>
        <Typography variant="h6" className="font-semibold mb-3">
          ğŸ“§ Send Test Email
        </Typography>
        <Grid container spacing={2} alignItems="center">
          <Grid item xs={12} md={8}>
            <TextField
              fullWidth
              label="Test Email Address"
              value={testEmail}
              onChange={(e) => setTestEmail(e.target.value)}
              placeholder="your-email@example.com"
              InputProps={{
                startAdornment: (
                  <InputAdornment position="start">
                    <Mail size={20} />
                  </InputAdornment>
                ),
              }}
            />
          </Grid>
          <Grid item xs={12} md={4}>
            <Button
              fullWidth
              variant="contained"
              onClick={handleSendTestEmail}
              disabled={loading || !testEmail}
              startIcon={loading ? <CircularProgress size={20} /> : <Send />}
              size="large"
            >
              Send Test Email
            </Button>
          </Grid>
        </Grid>

        {testResults && (
          <Alert
            severity={testResults.status === 'success' ? 'success' : 'error'}
            sx={{ mt: 3 }}
            onClose={() => setTestResults(null)}
          >
            <AlertTitle>{testResults.status === 'success' ? 'âœ… Success!' : 'âŒ Error'}</AlertTitle>
            {testResults.message}
            <Typography variant="caption" display="block" sx={{ mt: 1, opacity: 0.7 }}>
              {testResults.timestamp}
            </Typography>
          </Alert>
        )}
      </Paper>

      {/* Configuration Status */}
      <Paper sx={{ p: 3 }}>
        <Typography variant="h6" className="font-semibold mb-3">
          âš™ï¸ Configuration Status
        </Typography>
        <Grid container spacing={3}>
          {/* Email Config */}
          <Grid item xs={12} md={6}>
            <Card variant="outlined">
              <CardContent>
                <Box display="flex" alignItems="center" gap={2} mb={2}>
                  <Mail className="text-blue-500" />
                  <Typography variant="subtitle1" className="font-semibold">
                    Email Configuration
                  </Typography>
                </Box>
                <Box display="flex" flexDirection="column" gap={1}>
                  <Box display="flex" justifyContent="space-between" alignItems="center">
                    <Typography variant="caption">SMTP Host</Typography>
                    <Chip
                      label={import.meta.env.VITE_SMTP_HOST ? 'Configured' : 'Missing'}
                      size="small"
                      color={import.meta.env.VITE_SMTP_HOST ? 'success' : 'error'}
                    />
                  </Box>
                  <Box display="flex" justifyContent="space-between" alignItems="center">
                    <Typography variant="caption">Gmail User</Typography>
                    <Chip
                      label={import.meta.env.VITE_GMAIL_USER ? 'Configured' : 'Missing'}
                      size="small"
                      color={import.meta.env.VITE_GMAIL_USER ? 'success' : 'error'}
                    />
                  </Box>
                  <Box display="flex" justifyContent="space-between" alignItems="center">
                    <Typography variant="caption">App Password</Typography>
                    <Chip
                      label={import.meta.env.VITE_GMAIL_APP_PASSWORD ? 'Configured' : 'Missing'}
                      size="small"
                      color={import.meta.env.VITE_GMAIL_APP_PASSWORD ? 'success' : 'error'}
                    />
                  </Box>
                </Box>
              </CardContent>
            </Card>
          </Grid>

          {/* Fax Config */}
          <Grid item xs={12} md={6}>
            <Card variant="outlined">
              <CardContent>
                <Box display="flex" alignItems="center" gap={2} mb={2}>
                  <Printer className="text-green-500" />
                  <Typography variant="subtitle1" className="font-semibold">
                    Fax Configuration (Cloud Function)
                  </Typography>
                </Box>
                <Alert severity="info" sx={{ fontSize: '12px' }}>
                  <AlertTitle sx={{ fontSize: '13px' }}>Secure Architecture</AlertTitle>
                  Fax credentials are stored securely in Firebase Cloud Functions environment
                  variables. No API keys are exposed in client-side code.
                </Alert>
              </CardContent>
            </Card>
          </Grid>
        </Grid>
      </Paper>

      {/* System Info */}
      <Paper sx={{ p: 3 }}>
        <Typography variant="h6" className="font-semibold mb={3}>
          â„¹ï¸ System Information
        </Typography>
        <Grid container spacing={2}>
          <Grid item xs={12} sm={6} md={3}>
            <Card variant="outlined">
              <CardContent>
                <Typography variant="caption" color="text.secondary">
                  Email Aliases
                </Typography>
                <Typography variant="h6" className="font-bold">
                  {Object.keys(EMAIL_ALIASES).length}
                </Typography>
              </CardContent>
            </Card>
          </Grid>
          <Grid item xs={12} sm={6} md={3}>
            <Card variant="outlined">
              <CardContent>
                <Typography variant="caption" color="text.secondary">
                  Email Templates
                </Typography>
                <Typography variant="h6" className="font-bold">
                  {Object.keys(EMAIL_TEMPLATES).length}
                </Typography>
              </CardContent>
            </Card>
          </Grid>
          <Grid item xs={12} sm={6} md={3}>
            <Card variant="outlined">
              <CardContent>
                <Typography variant="caption" color="text.secondary">
                  Fax Destinations
                </Typography>
                <Typography variant="h6" className="font-bold">
                  {Object.keys(FAX_DESTINATIONS).length}
                </Typography>
              </CardContent>
            </Card>
          </Grid>
          <Grid item xs={12} sm={6} md={3}>
            <Card variant="outlined">
              <CardContent>
                <Typography variant="caption" color="text.secondary">
                  System Status
                </Typography>
                <Chip label="Operational" color="success" size="small" sx={{ mt: 1 }} />
              </CardContent>
            </Card>
          </Grid>
        </Grid>
      </Paper>
    </div>
  );

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: COMPOSE EMAIL DIALOG
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const renderComposeEmailDialog = () => (
    <Dialog open={showComposeEmail} onClose={() => setShowComposeEmail(false)} maxWidth="md" fullWidth>
      <DialogTitle>
        <Box display="flex" alignItems="center" gap={2}>
          <Mail className="text-blue-500" />
          <span>Compose Email</span>
        </Box>
        <IconButton
          onClick={() => setShowComposeEmail(false)}
          sx={{ position: 'absolute', right: 8, top: 8 }}
        >
          <X size={20} />
        </IconButton>
      </DialogTitle>
      
      <DialogContent dividers>
        <Box display="flex" flexDirection="column" gap={3}>
          {/* Recipient */}
          <TextField
            fullWidth
            label="To Email"
            value={emailForm.to}
            onChange={(e) => setEmailForm(prev => ({ ...prev, to: e.target.value }))}
            placeholder="recipient@example.com"
            required
          />

          {/* From Alias */}
          <FormControl fullWidth>
            <InputLabel>From Email Alias</InputLabel>
            <Select
              value={emailForm.fromAlias}
              label="From Email Alias"
              onChange={(e) => setEmailForm(prev => ({ ...prev, fromAlias: e.target.value }))}
            >
              {Object.entries(EMAIL_ALIASES).map(([key, alias]) => (
                <MenuItem key={key} value={key}>
                  {alias.name} ({alias.email})
                </MenuItem>
              ))}
            </Select>
          </FormControl>

          {/* Template Selection */}
          <FormControl fullWidth>
            <InputLabel>Email Template</InputLabel>
            <Select
              value={selectedTemplate || ''}
              label="Email Template"
              onChange={(e) => setSelectedTemplate(e.target.value)}
            >
              {Object.keys(EMAIL_TEMPLATES).map((key) => (
                <MenuItem key={key} value={key}>
                  {key.replace(/_/g, ' ')}
                </MenuItem>
              ))}
            </Select>
          </FormControl>

          {/* Subject */}
          <TextField
            fullWidth
            label="Subject"
            value={emailForm.subject}
            onChange={(e) => setEmailForm(prev => ({ ...prev, subject: e.target.value }))}
            required
          />

          {/* Template Variables */}
          {selectedTemplate && EMAIL_TEMPLATES[selectedTemplate]?.variables && (
            <Box>
              <Typography variant="subtitle2" className="mb-2">
                Template Variables:
              </Typography>
              <Grid container spacing={2}>
                {EMAIL_TEMPLATES[selectedTemplate].variables.map((varName) => (
                  <Grid item xs={12} sm={6} key={varName}>
                    <TextField
                      fullWidth
                      size="small"
                      label={varName.replace(/_/g, ' ')}
                      value={emailForm.variables[varName] || ''}
                      onChange={(e) => setEmailForm(prev => ({
                        ...prev,
                        variables: {
                          ...prev.variables,
                          [varName]: e.target.value,
                        },
                      }))}
                    />
                  </Grid>
                ))}
              </Grid>
            </Box>
          )}

          {/* Preview */}
          {previewHtml && (
            <Box>
              <Typography variant="subtitle2" className="mb-2">
                Preview:
              </Typography>
              <Paper
                variant="outlined"
                sx={{
                  p: 2,
                  maxHeight: 300,
                  overflow: 'auto',
                  bgcolor: '#F9FAFB',
                }}
              >
                <div dangerouslySetInnerHTML={{ __html: previewHtml }} />
              </Paper>
            </Box>
          )}
        </Box>
      </DialogContent>
      
      <DialogActions>
        <Button onClick={() => setShowComposeEmail(false)}>
          Cancel
        </Button>
        <Button
          variant="contained"
          onClick={handleSendEmail}
          disabled={loading || !emailForm.to || !emailForm.subject}
          startIcon={loading ? <CircularProgress size={20} /> : <Send />}
        >
          Send Email
        </Button>
      </DialogActions>
    </Dialog>
  );

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: SEND FAX DIALOG
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const renderSendFaxDialog = () => {
    const estimatedCost = faxService.calculateSavings(faxForm.pageCount, faxForm.sendToAll ? 3 : 1);

    return (
      <Dialog open={showSendFax} onClose={() => setShowSendFax(false)} maxWidth="sm" fullWidth>
        <DialogTitle>
          <Box display="flex" alignItems="center" gap={2}>
            <Printer className="text-green-500" />
            <span>Send Fax</span>
          </Box>
          <IconButton
            onClick={() => setShowSendFax(false)}
            sx={{ position: 'absolute', right: 8, top: 8 }}
          >
            <X size={20} />
          </IconButton>
        </DialogTitle>
        
        <DialogContent dividers>
          <Box display="flex" flexDirection="column" gap={3}>
            {/* Send to All Toggle */}
            <FormControlLabel
              control={
                <Switch
                  checked={faxForm.sendToAll}
                  onChange={(e) => setFaxForm(prev => ({ ...prev, sendToAll: e.target.checked }))}
                />
              }
              label="Send to all 3 credit bureaus"
            />

            {/* Single Destination */}
            {!faxForm.sendToAll && (
              <FormControl fullWidth>
                <InputLabel>Destination</InputLabel>
                <Select
                  value={faxForm.destination}
                  label="Destination"
                  onChange={(e) => setFaxForm(prev => ({ ...prev, destination: e.target.value }))}
                >
                  <MenuItem disabled>
                    <em>Credit Bureaus</em>
                  </MenuItem>
                  {destinationGroups.bureaus.map(([key, dest]) => (
                    <MenuItem key={key} value={key}>
                      {dest.name} - {dest.fax}
                    </MenuItem>
                  ))}
                  <MenuItem disabled>
                    <em>Creditors</em>
                  </MenuItem>
                  {destinationGroups.creditors.map(([key, dest]) => (
                    <MenuItem key={key} value={key}>
                      {dest.name} - {dest.fax}
                    </MenuItem>
                  ))}
                  <MenuItem disabled>
                    <em>Collections</em>
                  </MenuItem>
                  {destinationGroups.collections.map(([key, dest]) => (
                    <MenuItem key={key} value={key}>
                      {dest.name} - {dest.fax}
                    </MenuItem>
                  ))}
                </Select>
              </FormControl>
            )}

            {/* PDF URL */}
            <TextField
              fullWidth
              label="PDF URL or Base64"
              value={faxForm.pdfUrl}
              onChange={(e) => setFaxForm(prev => ({ ...prev, pdfUrl: e.target.value }))}
              placeholder="https://... or data:application/pdf;base64,..."
              multiline
              rows={3}
              required
            />

            {/* Page Count */}
            <TextField
              fullWidth
              type="number"
              label="Page Count"
              value={faxForm.pageCount}
              onChange={(e) => setFaxForm(prev => ({ ...prev, pageCount: parseInt(e.target.value) || 1 }))}
              inputProps={{ min: 1, max: 100 }}
            />

            {/* Priority */}
            <FormControl fullWidth>
              <InputLabel>Priority</InputLabel>
              <Select
                value={faxForm.priority}
                label="Priority"
                onChange={(e) => setFaxForm(prev => ({ ...prev, priority: e.target.value }))}
              >
                <MenuItem value={FAX_PRIORITY.URGENT}>ğŸ”´ Urgent (Send Immediately)</MenuItem>
                <MenuItem value={FAX_PRIORITY.HIGH}>ğŸŸ¡ High (Within 1 Hour)</MenuItem>
                <MenuItem value={FAX_PRIORITY.NORMAL}>ğŸŸ¢ Normal (Within 4 Hours)</MenuItem>
                <MenuItem value={FAX_PRIORITY.LOW}>âšª Low (Within 24 Hours)</MenuItem>
              </Select>
            </FormControl>

            {/* Client & Dispute IDs */}
            <Grid container spacing={2}>
              <Grid item xs={12} sm={6}>
                <TextField
                  fullWidth
                  label="Client ID"
                  value={faxForm.clientId}
                  onChange={(e) => setFaxForm(prev => ({ ...prev, clientId: e.target.value }))}
                  placeholder="Optional"
                />
              </Grid>
              <Grid item xs={12} sm={6}>
                <TextField
                  fullWidth
                  label="Dispute ID"
                  value={faxForm.disputeId}
                  onChange={(e) => setFaxForm(prev => ({ ...prev, disputeId: e.target.value }))}
                  placeholder="Optional"
                />
              </Grid>
            </Grid>

            {/* Auto-Retry */}
            <FormControlLabel
              control={
                <Switch
                  checked={faxForm.autoRetry}
                  onChange={(e) => setFaxForm(prev => ({ ...prev, autoRetry: e.target.checked }))}
                />
              }
              label="Enable AI-powered auto-retry on failure"
            />

            {/* Cost Estimate */}
            <Alert severity="success">
              <AlertTitle>ğŸ’° Cost Estimate</AlertTitle>
              <Grid container spacing={1}>
                <Grid item xs={6}>
                  <Typography variant="caption" display="block">
                    Telnyx Cost:
                  </Typography>
                  <Typography variant="body2" className="font-bold">
                    ${estimatedCost.telnyx.total}
                  </Typography>
                </Grid>
                <Grid item xs={6}>
                  <Typography variant="caption" display="block">
                    USPS Cost:
                  </Typography>
                  <Typography variant="body2" className="font-bold" color="text.secondary">
                    ${estimatedCost.usps.total}
                  </Typography>
                </Grid>
                <Grid item xs={12}>
                  <Chip
                    label={`Save $${estimatedCost.savings.amount} (${estimatedCost.savings.percent}%)`}
                    color="success"
                    size="small"
                    sx={{ mt: 1 }}
                  />
                </Grid>
              </Grid>
            </Alert>
          </Box>
        </DialogContent>
        
        <DialogActions>
          <Button onClick={() => setShowSendFax(false)}>
            Cancel
          </Button>
          <Button
            variant="contained"
            onClick={handleSendFax}
            disabled={loading || !faxForm.pdfUrl}
            startIcon={loading ? <CircularProgress size={20} /> : <Printer />}
            color="success"
          >
            Send Fax
          </Button>
        </DialogActions>
      </Dialog>
    );
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // RENDER: LOGIN DIALOG
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  const renderLoginDialog = () => (
    <Dialog open={showLoginDialog} onClose={() => setShowLoginDialog(false)}>
      <DialogTitle>
        <Box display="flex" alignItems="center" gap={2}>
          <Shield className="text-blue-500" />
          <span>Sign In Required</span>
        </Box>
      </DialogTitle>
      <DialogContent>
        <Typography>
          You must be signed in to send emails or faxes.
        </Typography>
      </DialogContent>
      <DialogActions>
        <Button onClick={() => setShowLoginDialog(false)}>
          Cancel
        </Button>
        <Button onClick={handleLogin} variant="contained" disabled={loading}>
          {loading ? <CircularProgress size={20} /> : 'Sign in with Google'}
        </Button>
      </DialogActions>
    </Dialog>
  );

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // MAIN RENDER
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  return (
    <Box sx={{ p: { xs: 2, md: 3 } }}>
      {/* Header */}
      <Box mb={3}>
        <Typography variant="h4" className="font-bold mb-1">
          ğŸ“§ğŸ“  AI-Enhanced Communications Manager
        </Typography>
        <Typography variant="body2" color="text.secondary">
          Enterprise-grade email & fax system with intelligent automation
        </Typography>
      </Box>

      {/* Error/Success Messages */}
      {error && (
        <Alert severity="error" sx={{ mb: 2 }} onClose={() => setError(null)}>
          {error}
        </Alert>
      )}

      {success && (
        <Alert severity="success" sx={{ mb: 2 }} onClose={() => setSuccess(null)}>
          {success}
        </Alert>
      )}

      {/* Main Content */}
      <Paper>
        <Tabs
          value={activeTab}
          onChange={(e, newValue) => setActiveTab(newValue)}
          variant="scrollable"
          scrollButtons="auto"
          sx={{ borderBottom: 1, borderColor: 'divider' }}
        >
          <Tab
            value="dashboard"
            label="Dashboard"
            icon={<BarChart3 size={20} />}
            iconPosition="start"
          />
          <Tab
            value="email"
            label="Email"
            icon={<Mail size={20} />}
            iconPosition="start"
          />
          <Tab
            value="fax"
            label="Fax"
            icon={<Printer size={20} />}
            iconPosition="start"
          />
          <Tab
            value="history"
            label="History"
            icon={<Clock size={20} />}
            iconPosition="start"
          />
          <Tab
            value="analytics"
            label="Analytics"
            icon={<TrendingUp size={20} />}
            iconPosition="start"
          />
          <Tab
            value="test"
            label="Testing"
            icon={<Zap size={20} />}
            iconPosition="start"
          />
        </Tabs>

        <Box sx={{ p: { xs: 2, md: 3 } }}>
          {activeTab === 'dashboard' && renderDashboardTab()}
          {activeTab === 'email' && renderEmailTab()}
          {activeTab === 'fax' && renderFaxTab()}
          {activeTab === 'history' && renderHistoryTab()}
          {activeTab === 'analytics' && renderAnalyticsTab()}
          {activeTab === 'test' && renderTestTab()}
        </Box>
      </Paper>

      {/* Dialogs */}
      {renderComposeEmailDialog()}
      {renderSendFaxDialog()}
      {renderLoginDialog()}
    </Box>
  );
};

export default EmailFaxManager;